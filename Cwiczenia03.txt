-- Zadanie 1 --

CREATE OR REPLACE VIEW v_wysokie_pensje AS
SELECT employee_id, first_name, last_name, salary
FROM employees
WHERE salary > 6000;

SELECT * FROM v_wysokie_pensje ORDER BY salary DESC;
SELECT COUNT(*) FROM v_wysokie_pensje;

-- Zadanie 2 --

CREATE OR REPLACE VIEW v_wysokie_pensje AS
SELECT employee_id, first_name, last_name, salary
FROM employees
WHERE salary > 12000;

SELECT * FROM v_wysokie_pensje ORDER BY salary DESC;
SELECT COUNT(*) FROM v_wysokie_pensje;

-- Zadanie 3 --

DROP VIEW v_wysokie_pensje;

-- Zadanie 4 --

CREATE OR REPLACE VIEW v_finance_pracownicy AS
SELECT e.employee_id, e.last_name, e.first_name
FROM employees e
JOIN departments d ON e.department_id = d.department_id
WHERE d.department_name = 'Finance';

SELECT * FROM v_finance_pracownicy ORDER BY last_name;

-- Zadanie 5 --

CREATE OR REPLACE VIEW v_pracownicy_5000_12000 AS
SELECT employee_id, last_name, first_name, salary, job_id, email, hire_date
FROM employees
WHERE salary BETWEEN 5000 AND 12000;

SELECT * FROM v_pracownicy_5000_12000 ORDER BY salary DESC;
SELECT COUNT(*) FROM v_pracownicy_5000_12000;

-- Zadanie 6 --
	-- a --
INSERT INTO v_pracownicy_5000_12000(employee_id, last_name, first_name, salary, job_id, email, hire_date)
VALUES (9910,'Nowy','Insert',7000,'SA_REP','nowy.insert@example.com',SYSDATE);

SELECT * FROM employees WHERE employee_id = 9910;

	-- b --
UPDATE v_pracownicy_5000_12000
SET salary = salary + 500
WHERE employee_id = 9910;

SELECT * FROM employees WHERE employee_id = 9910;

	-- c --
DELETE FROM v_pracownicy_5000_12000 WHERE employee_id = 9910;

SELECT * FROM employees WHERE employee_id = 9910;

-- Zadanie 7 --

CREATE OR REPLACE VIEW v_dzialy_min4 AS
SELECT
  d.department_id,
  d.department_name,
  COUNT(e.employee_id) AS liczba_pracownikow,
  ROUND(AVG(e.salary), 2) AS srednia_pensja,
  MAX(e.salary) AS najwyzsza_pensja
FROM departments d
JOIN employees e ON d.department_id = e.department_id
GROUP BY d.department_id, d.department_name
HAVING COUNT(e.employee_id) >= 4;

SELECT * FROM v_dzialy_min4 ORDER BY liczba_pracownikow DESC;

INSERT INTO v_dzialy_min4(department_id, department_name, liczba_pracownikow)
VALUES (999, 'TestDept', 4);

-- Zadanie 8 --

CREATE OR REPLACE VIEW v_pracownicy_5000_12000_chk AS
SELECT employee_id, last_name, first_name, salary, job_id, email, hire_date
FROM employees
WHERE salary BETWEEN 5000 AND 12000
WITH CHECK OPTION;

	-- a --

INSERT INTO v_pracownicy_5000_12000_chk(employee_id, last_name, first_name, salary, job_id, email, hire_date)
VALUES (9950, 'Ok', 'Between', 8000, 'SA_REP', 'ok.between@example.com', SYSDATE);

SELECT * FROM employees WHERE employee_id = 9950;

	-- b --
	
INSERT INTO v_pracownicy_5000_12000_chk(employee_id, last_name, first_name, salary, job_id, email, hire_date)
VALUES (9951, 'Bad', 'High', 13000, 'AD_PRES', 'bad.high@example.com', SYSDATE);

-- Zadanie 9 --

CREATE MATERIALIZED VIEW v_managerowie
BUILD IMMEDIATE
REFRESH ON DEMAND
AS
SELECT DISTINCT m.employee_id, m.first_name || ' ' || m.last_name AS manager_name,
       d.department_name
FROM employees m
JOIN departments d ON m.department_id = d.department_id
WHERE m.employee_id IN (SELECT DISTINCT manager_id FROM employees WHERE manager_id IS NOT NULL);

SELECT * FROM v_managerowie ORDER BY manager_name;

-- Zadanie 10 --

CREATE OR REPLACE VIEW v_najlepiej_oplacani AS
SELECT employee_id, first_name || ' ' || last_name AS imie_nazwisko, salary
FROM employees
ORDER BY salary DESC
FETCH FIRST 10 ROWS ONLY;

SELECT * FROM v_najlepiej_oplacani;
